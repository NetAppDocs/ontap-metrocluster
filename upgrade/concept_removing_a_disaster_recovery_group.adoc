---
permalink: upgrade/concept_removing_a_disaster_recovery_group.html
sidebar: sidebar
keywords:
summary: 'Beginning with ONTAP 9.8, you can remove a DR group from an eight-node MetroCluster configuration to create a four-node MetroCluster configuration.'
---
= Remove a DR group from a MetroCluster configuration
:icons: font
:imagesdir: ../media/

[.lead]
Beginning with ONTAP 9.8, you can remove a disaster recovery (DR) group from an eight-node MetroCluster configuration to create a four-node MetroCluster configuration.

NOTE: You use these steps as part of the transition and system refresh workflows. 

== Enable console logging

include::../_include/console-logging.adoc[]

// 2024 Aug 13, ONTAPDOC-1988

== Remove the DR group nodes from each cluster

This procedure is supported on ONTAP 9.8 and later. For systems running ONTAP 9.7 or earlier, see the Knowledge Base article: link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/MetroCluster/How_to_remove_a_DR-Group_from_a_MetroCluster[How to remove a DR group from a MetroCluster configuration^].

.About this task

An eight-node configuration includes eight-nodes organized as two four-node DR groups.

image::../media/mcc_dr_groups_8_node.gif[]

When you remove a DR group, four nodes remain in the configuration.

image::../media/mcc_dr_groups_4_node.gif[]

.Before you begin

* You must perform this step on both clusters.
* The `metrocluster remove-dr-group` command is supported only on ONTAP 9.8 and later.

.Steps

. Prepare to remove the DR group if you have not already.
 .. Move all data volumes to another DR group.
 .. If the DR group to be removed has load-sharing mirror volumes, re-create all load-sharing mirror volumes in another DR group and delete them from the DR group to be removed.
 .. Move all MDV_CRS metadata volumes to another DR group by following the link:https://docs.netapp.com/us-en/ontap-metrocluster/upgrade/task_move_a_metadata_volume_in_mcc_configurations.html[Moving a metadata volume in MetroCluster configurations] procedure.
 .. Delete all MDV_aud metadata volumes that might exist in the DR group to be removed.
 .. Delete all data aggregates in the DR group to be removed:
+
----
ClusterA::> storage aggregate show -node ClusterA-01, ClusterA-02 -fields aggregate ,node
ClusterA::> aggr delete -aggregate aggregate_name
ClusterB::> storage aggregate show -node ClusterB-01, ClusterB-02 -fields aggregate ,node
ClusterB::> aggr delete -aggregate aggregate_name
----
+
NOTE: Root aggregates are not deleted.

 .. Migrate all NAS data LIFs that you use for NFS and CIFS (SMB) to home nodes in another DR group.
 +
`network interface show -home-node <old_node>`
+
`network interface migrate -vserver <svm_name> -lif <data_lif> -destination-node <new_node> -destination-port <port>`

 .. Move the data LIFs to the new home node in another DR group.
 `network interface modify -vserver <svm-name> -lif <data-lif> -home-node <new_node> -home-port <port>`

 .. Migrate the cluster management LIF to a home node in another DR group.
+
`network interface show -role cluster-mgmt`
+
`network interface modify -vserver <svm-name> -lif <cluster_mgmt> -home-node <new_node> -home-port <port-id>`
+
[NOTE]
====
* Node management and inter-cluster LIFs are not migrated. Create new node management and inter-cluster LIFs on nodes of the DR group as required.

* You cannot migrate or move FCP interfaces used for block access (SAN) between the nodes. Create new FCP interfaces as needed.

* iSCSI SAN LIFs need to be down before the home node and home port can be updated.
====


.. Transfer epsilon to a node in another DR group if required.
+
----
ClusterA::> set advanced
ClusterA::*> cluster show
Move epsilon if needed
ClusterA::*> cluster modify -node nodename -epsilon false
ClusterA::*> cluster modify -node nodename -epsilon true

ClusterB::> set advanced
ClusterB::*> cluster show
ClusterB::*> cluster modify -node nodename -epsilon false
ClusterB::*> cluster modify -node nodename -epsilon true
ClusterB::*> set admin
----
. Identify and remove the DR group.
.. Identify the correct DR group for removal:
+
`metrocluster node show`
.. Remove the DR group nodes:
 +
`metrocluster remove-dr-group -dr-group-id 1`
+
The following example shows the removal of the DR group configuration on cluster_A.
+
----
cluster_A::*>

Warning: Nodes in the DR group that are removed from the MetroCluster
         configuration will lose their disaster recovery protection.

         Local nodes "node_A_1-FC, node_A_2-FC"will be removed from the
         MetroCluster configuration. You must repeat the operation on the
         partner cluster "cluster_B"to remove the remote nodes in the DR group.
Do you want to continue? {y|n}: y

Info: The following preparation steps must be completed on the local and partner
      clusters before removing a DR group.

      1. Move all data volumes to another DR group.
      2. Move all MDV_CRS metadata volumes to another DR group.
      3. Delete all MDV_aud metadata volumes that may exist in the DR group to
      be removed.
      4. Delete all data aggregates in the DR group to be removed. Root
      aggregates are not deleted.
      5. Migrate all data LIFs to home nodes in another DR group.
      6. Migrate the cluster management LIF to a home node in another DR group.
      Node management and inter-cluster LIFs are not migrated.
      7. Transfer epsilon to a node in another DR group.

      The command is vetoed if the preparation steps are not completed on the
      local and partner clusters.
Do you want to continue? {y|n}: y
[Job 513] Job succeeded: Remove DR Group is successful.

cluster_A::*>
----
. Repeat the previous step on the partner cluster.


. Disable storage failover on the nodes of the old DR group: 
+
`storage failover modify -node <node-name> -enable false`

. If you are in a MetroCluster IP configuration, perform the following steps to delete the remote plexes of the root aggregates and remove disk ownership on the nodes of the old DR group.
+
These steps need to be performed for both nodes in the HA pair at each site.
+
..  Display the remote plexes of root aggregates on the nodes in the DR group that is to be deleted:
+
`storage aggregate plex show -aggregate <root_aggr_name> -pool 1`

.. Delete the remote plexes:
+
`storage aggregate plex delete -aggregate <root_aggr_name> -plex <plex_from_previous_step>`

.. Identify the remote disks owned by the nodes in the DR group.
+
The commands you use depend on whether you are using partitioned/shared disks or whole disks:
+
NOTE: Use a comma-separated list in the `-owner <node_names>` field to specify the node names in the DR group that is to be deleted.
+
[role="tabbed-block"]
====
.Partitioned/shared disks:
--
... Set the privilege level to advanced:
+
`set advanced`

... Display the remote disks:
+
`storage disk show -pool Pool1 -owner <node_names> -partition-ownership`
--
.Whole disks:
--
... Set the privilege level to advanced:
+
`set advanced`

... Display the remote disks:
+
`storage disk show -pool Pool1 -owner <node_names>`
--
====

.. Disable disk auto assignment:
+
`disk option modify -node <node_names_in_the_DR_group_to_be_deleted>  -autoassign off`

.. Remove ownership of pool1 disks on each DR group node to be deleted. Perform these steps on each node to be removed.
+
... Go to the nodeshell:
+
`run -node <node_name>`
+
... Identify the pool1 disks:
+
`aggr status -s` 
+
All spare disks are displayed, including the pool0 and pool1 spare disks owned by the node.

... Remove disk ownership for each pool1 spare disk:
+
`disk remove_ownership <disk_name>`
+
For partitioned disks, remove partition ownership and then remove the container disk ownership.

. If you are in a MetroCluster IP configuration, remove the MetroCluster connections on the nodes of the old DR group.
+
These commands can be issued from either cluster and apply to the entire DR group spanning both the clusters.

.. Disconnect the connections:
+
`metrocluster configuration-settings connection disconnect -dr-group-id <dr_group_id>`
+
.Example
+
[%collapsible]
=====
----
cluster_A::*> metrocluster configuration-settings connection disconnect -dr-group-id 1

Warning: For the nodes in the DR group 1, this command will remove the existing connections that are used to mirror NV logs and access remote storage.
Do you want to continue? {y|n}: y

Warning: Before proceeding with disconnect, you must verify the following:
      1. Unmirrored aggregates do not have disks in remote plexes.
      2. Aggregates are not mirrored.
      3. No disks are assigned in Pool1.
      4. Storage failover is not enabled.
      Follow the "MetroCluster Installation and Configuration guide" for detailed instructions to verify this.
Do you want to continue? {y|n}: y
----
=====
.. Delete the MetroCluster interfaces on the nodes of the old DR group:
+
NOTE: This step must be repeated on each node of the DR group.
+
`metrocluster configuration-settings interface delete`

.. Delete the old DR group's configuration.
 +
`metrocluster configuration-settings dr-group delete`

. Unjoin the nodes in the old DR group.
+
Perform this step on each cluster.

.. Set the advanced privilege level:
+
`set -privilege advanced`

.. Unjoin the node:
 +
`cluster unjoin -node <node-name>`
+
Repeat this step for the other local node in the old DR group.

.. Set the admin privilege level:
+
`set -privilege admin`

. Check that cluster HA is enabled in the new DR group. If required, re-enable cluster HA:
+
`cluster ha modify -configured true`
+
Perform this step on each cluster.

. Halt, power down, and remove the old controller modules and storage shelves.

// 2025 Sept 16, ONTAPDOC-3201
// 2022 SEPT 26 BURT 1501656
// 2022-NOV-15 GitHub issue 232, 234 
// 2024-02-13, GitHub issue 233
// BURT 1419399, 2021-11-18