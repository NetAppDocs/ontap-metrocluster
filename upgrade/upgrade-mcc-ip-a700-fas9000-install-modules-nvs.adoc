---
permalink: upgrade/upgrade-mcc-ip-a700-fas9000-install-modules-nvs.html
sidebar: sidebar
keywords: metrocluster, upgrade, controllers, switchover, switchback, ip, configuration, net, boot, root, aggregate, system, commands, mcc
summary: 'You can use this guided automated MetroCluster switchover operation to perform a non-disruptive controller upgrade for a four-node MetroCluster IP configuration.'
---
= Install the AFF A900 or FAS9500 NVS and controller modules
:icons: font
:imagesdir: ../media/

[.lead]
You must install the AFF A900 or FAS9500 NVS and controller module that you received in the upgrade kit on both nodes at site_B. Do not move the coredump device from the AFF A700 or FAS9000 NVS module to the AFF A900 or FAS9500 NVS module.

.About this task
If you are not already grounded, properly ground yourself.

== Install the AFF A900 or FAS9500 NVS
Use the following procedure to install the AFF A900 or FAS9500 NVS in slot 6 of both nodes at site_B.

.Steps
.	Align the NVS with the edges of the chassis opening in slot 6.
.	Gently slide the NVS into the slot until the lettered and numbered I/O cam latch begins to engage with the I/O cam pin, and then push the I/O cam latch all the way up to lock the NVS in place.
+
image::../media/drw_a900_move-remove_NVRAM_module.png[remove module]
+
|===
|image:../media/number1.png[number 1] |Lettered and numbered I/O cam latch
|image:../media/number2.png[number 2] |I/O latch completely unlocked
|===

== Install the AFF A900 or FAS9500 controller module.
Use the following procedure to install the AFF A900 or FAS9500 controller module.

.Steps
.	Align the end of the controller module with the opening in the chassis, and then gently push the controller module halfway into the system.
.	Firmly push the controller module into the chassis until it meets the midplane and is fully seated.
The locking latch rises when the controller module is fully seated.
Attention: To avoid damaging the connectors, do not use excessive force when sliding the controller module into the chassis.
.	Cable the management and console ports to the controller module.
+
image::../media/drw_9500_remove_PCM.png[controller module]
+
|===
|image:../media/number1.png[number 1] |Cam handle release button
|image:../media/number2.png[number2] |Cam handle
|===


. Install the second X91146A card in slot 7 of each node.
..	Move the e5b connection to e7b.
..	Move the e5a connection to e5b.
+
NOTE: Slot 7 on all nodes of the cluster should be empty as mentioned in the link:upgrade-mcc-ip-a700-fas9000-prepare-system.html#upgrade_a700_a900_ip_map[Map ports from the old nodes to the new nodes] section.
.	Power ON the chassis and connect to serial console.
.	After BIOS initialization, if the node starts autoboot, interrupt the AUTOBOOT by pressing Control-C.
.	After autoboot is interrupted, the nodes stop at the LOADER prompt. If you do not interrupt autoboot on time and node1 starts booting, wait for the prompt to press Ctrl-C to go into the boot menu. After the node stops at the boot menu, use option 8 to reboot the node and interrupt the autoboot during reboot.
.	At the LOADER prompt, set the default environment variables:
set-defaults
.	Save the default environment variables settings:
`saveenv`

== Netboot nodes at site_B

After swapping the AFF A900 or FAS9500 controller module and NVS, you need to netboot the AFF A900 or FAS9500 nodes and install the same ONTAP version and patch level that is running on the cluster. The term netboot means you are booting from an ONTAP image stored on a remote server. When preparing for netboot, you must add a copy of the ONTAP 9 boot image onto a web server that the system can access.
It is not possible to check the version of ONTAP installed on the boot media of an AFF A900 or FAS9500 controller module unless it is installed in a chassis and powered ON. The ONTAP version on the AFF A900 or FAS9500 boot media must be the same as the ONTAP version running on the AFF A700 or FAS9000 system that is being upgraded and both the primary and backup boot images should match. You can configure the images by performing a netboot followed by the `wipeconfig` command from the boot menu. If the controller module was previously used in another cluster, the `wipeconfig` command clears any residual configuration on the boot media.

.Before you begin
* Verify that you can access a HTTP server with the system.
* You need to download the necessary system files for your system and the correct version of ONTAP from the NetApp Support Site.

.About this task
You must netboot the new controllers, if the version of ONTAP installed is not the same as the version installed on the original controllers. After you install each new controller, you boot the system from the ONTAP 9 image stored on the web server. You can then download the correct files to the boot media device for subsequent system boots.


.Steps
. Access the https://mysupport.netapp.com/site/[NetApp Support Site^] to download the files used for performing the netboot of the system.
. [[step2-download-software]]Download the appropriate ONTAP software from the software download section of the NetApp Support Site and store the `ontap-version_image.tgz` file on a web-accessible directory.
. Change to the web-accessible directory and verify that the files you need are available.
.	Your directory listing should contain <ontap_version>\_image.tgz.
.	Configure the netboot connection by choosing one of the following actions.
+
NOTE:	You should use the management port and IP as the netboot connection. Do not use a data LIF IP or a data outage might occur while the upgrade is being performed.
+

|===

h| If the Dynamic Host Configuration Protocol (DCHP) is... h| Then...

a|
Running
a|
Configure the connection automatically by using the following command at the boot environment prompt:
`ifconfig e0M -auto`
a|
Not Running
a|
Manually configure the connection by using the following command at the boot environment prompt:
`ifconfig e0M -addr=<filer_addr> -mask=<netmask> -gw=<gateway> - dns=<dns_addr> domain=<dns_domain>`

`<filer_addr>` is the IP address of the storage system. `<netmask>` is the network mask of the storage system.
`<gateway>` is the gateway for the storage system.
`<dns_addr>` is the IP address of a name server on your network. This parameter is optional.
`<dns_domain>` is the Domain Name Service (DNS) domain name. This parameter is optional.
NOTE:	Other parameters might be necessary for your interface. Enter `help ifconfig` at the firmware prompt for details.
|===

.	Perform netboot on node_B_1:
`netboot` `\http://<web_server_ip/path_to_web_accessible_directory>/netboot/kernel`
+
The `<path_to_the_web-accessible_directory>` should lead to where you downloaded the `<ontap_version>\_image.tgz` in <<step2-download-software, Step 2>>.
+
NOTE:	Do not interrupt the boot.

.	Wait for the node_B_1 now running on the AFF A900 or FAS9500 controller module to boot and display the boot menu options as shown below:
+
----
Please choose one of the following:

(1)  Normal Boot.
(2)  Boot without /etc/rc.
(3)  Change password.
(4)  Clean configuration and initialize all disks.
(5)  Maintenance mode boot.
(6)  Update flash from backup config.
(7)  Install new software first.
(8)  Reboot node.
(9)  Configure Advanced Drive Partitioning.
(10) Set Onboard Key Manager recovery secrets.
(11) Configure node for external key management.
Selection (1-11)?
----
.	From the boot menu, select option ``(7) Install new software first.``
This menu option downloads and installs the new ONTAP image to the boot device.
NOTE:	Disregard the following message: `This procedure is not supported for Non-Disruptive Upgrade on an HA pair.` This note applies to nondisruptive ONTAP software upgrades, and not controller upgrades.
+
Always use netboot to update the new node to the desired image. If you use another method to install the image on the new controller, the incorrect image might install. This issue applies to all ONTAP releases.

.	If you are prompted to continue the procedure, enter `y`, and when prompted for the package, enter the URL:
`\http://<web_server_ip/path_to_web-accessible_directory>/<ontap_version>\_image.tgz`
.	Complete the following substeps to reboot the controller module:
..	Enter `n` to skip the backup recovery when you see the following prompt:
`Do you want to restore the backup configuration now? {y|n}`
..	Enter ``y to reboot when you see the following prompt:
`The node must be rebooted to start using the newly installed software. Do you want to reboot now? {y|n}``
The controller module reboots but stops at the boot menu because the boot device was reformatted, and the configuration data needs to be restored.
.	At the prompt, run the `wipeconfig` command to clear any previous configuration on the boot media:
..	When you see the following message, answer `yes`:
`This will delete critical system configuration, including cluster membership.
Warning: do not run this option on a HA node that has been taken over.
Are you sure you want to continue?:`
..	The node reboots to finish the `wipeconfig` and then stops at the boot menu.
.	Select option `5` to go to maintenance mode from the boot menu. Answer `yes` to the prompts until the node stops at maintenance mode and the command prompt \*>.
. Repeat these steps to netboot node_B_2.
